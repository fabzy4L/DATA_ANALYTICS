---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
#Using the system's time as a variable that changes with seed setting
#set.seed(as.integer(Sys.time()))
#rnorm(5) # 5 values

#set.seed(as.integer(10)) # random generated values, fixed to a integer 10, makes static randomly generated numbers. 
#rnorm(5) # 5 values 
```


```{r}
#install.packages('gmodels')
library(limma)
library(gmodels)

set.seed(4684)  #fixed set of randomly generated numbers

y <- rnorm(100) # 100 data points

x.true <- rnorm(100, 
                mean=y, 
                sd=0.25) #100 data points, 

x <-  factor(cut(x.true,
                 c(-4,-1.5,0,1.5,4))) #makes clusters from the data generated by x.true, which fall within the ranges of the values assigned as thresholds c(-4,-1.5,0,1.5,4)

reg <- lm(y ~ x) # object with linear model

summary(reg)
```


```{r}
x.true
x
```


```{r}
# Mirror default treatment contrasts

test <- make.contrasts(rbind( c(-1,1,0,0), c(-1,0,1,0), c(-1,0,0,1) ))
test

lm( y ~ x, contrasts=list(x = test ))
```


```{r}
# Specify some more complicated contrasts
#   - mean of 1st group vs mean of 4th group
#   - mean of 1st and 2nd groups vs mean of 3rd and 4th groups
#   - mean of 1st group vs mean of 2nd, 3rd and 4th groups

cmat <- rbind( "1 vs 4"    =c(-1, 0, 0, 1),
               "1+2 vs 3+4"=c(-1/2,-1/2, 1/2, 1/2),
               "1 vs 2+3+4"=c(-3/3, 1/3, 1/3, 1/3))

summary(lm( y ~ x, contrasts=list(x=make.contrasts(cmat) )))
```


```{r}
# or
contrasts(x) <- make.contrasts(cmat)
summary(lm( y ~ x ) )
```


```{r}
# or use contrasts.lm
reg <- lm(y ~ x)
fit.contrast( reg, "x", cmat )
```


```{r}
# compare with values computed directly using group means
gm <- sapply(split(y,x),mean)
gm
```


```{r}
# }
# NOT RUN {
#<!-- %*% t(cmat) -->
# }
# NOT RUN {

#
```


```{r}
# Example for Analysis of Variance
#

set.seed(03215)
Genotype <- sample(c("WT","KO"), 1000, replace=TRUE)
Time <- factor(sample(1:3, 1000, replace=TRUE))
data <- data.frame(y, Genotype, Time)
y <- rnorm(1000)

data <- data.frame(y, Genotype, as.factor(Time))
```


```{r}
# Compute Contrasts & obtain 95% confidence intervals

model <- aov( y ~ Genotype + Time + Genotype:Time, data=data )

fit.contrast( model, "Genotype", rbind("KO vs WT"=c(-1,1) ), conf=0.95 )

fit.contrast( model, "Time",
            rbind("1 vs 2"=c(-1,1,0),
                  "2 vs 3"=c(0,-1,1)
                  ),
            conf=0.95 )


cm.G <- rbind("KO vs WT"=c(-1,1) )
cm.T <- rbind("1 vs 2"=c(-1,1,0),
              "2 vs 3"=c(0,-1,1) )
```


```{r}
# Compute contrasts and show SSQ decompositions

model <- model <- aov( y ~ Genotype + Time + Genotype:Time, data=data,
                      contrasts=list(Genotype=make.contrasts(cm.G),
                                     Time=make.contrasts(cm.T) )
                      )

summary(model, split=list( Genotype=list( "KO vs WT"=1 ),
                           Time = list( "1 vs 2" = 1,
                                        "2 vs 3" = 2 ) ) )
```

